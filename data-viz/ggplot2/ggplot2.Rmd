---
title: "Data Visualization with ggplot2"
author: "Anthony Chau"
institute: "UCI Center for Statistical Consulting"
date: "7/24/2021 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: ["default", "style.css", "metropolis-fonts"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
params:
  html_slides: TRUE
  pdf_slides: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.dim=c(4.8, 4.5), 
                      fig.retina=2, 
                      out.width="100%",
                      comment = "#>")
library(ggplot2)
```

```{css, echo=FALSE}
.code-bg .remark-code {
  background-color: rgba(255, 210, 0, 0.2);
}
```

# What is ggplot2?

.big-text-font[
- `ggplot2` is a R package for creating statistical and data graphics
- `ggplot2`'s approach to graphics is based on [The Grammar of Graphics](http://vita.had.co.nz/papers/layered-grammar.pdf)
- Mature (14 years old) and popular package
- Powerful and extensible
]

---

# Grammar of Graphics
.big-text-font[
- Big idea: a visualization is constructed from many independent components
- We put together different components to create our desired visualization
- Components of a plot:
    - Data
    - Aesthetic mappings
    - Geometric objects
    - Scales
    - Facet specification
    - Statistical Transformation
    - Coordinate System
]

---

# Example

.big-text-font[
- Let's use ggplot2 on an example dataset to illustrate how it works
- [Dataset](https://ggplot2.tidyverse.org/reference/midwest.html) contains demographics information for the US Midwest from 2000 Census
]

.code-bg[
```{r mpg, collapse=TRUE}
midwest <- ggplot2::midwest
head(midwest, 1)
dim(midwest)
colnames(midwest)
```
]

---
# Midwest Demographics

.big-text-font[
- Suppose we wanted to know the relationship between the percent of people below poverty line and the percent of people college educated
- What would you expect the graph to look like?
]

---

# Midwest Demographics

.left-code[
```{r midwest-scatterplot, eval=FALSE}
ggplot(midwest) +
  aes(x = percadultpoverty, 
      y = percollege) + 
  geom_point()
```
]

.right-plot[
```{r midwest-scatterplot-out, ref.label="midwest-scatterplot", echo=FALSE}
```
]

---

# Recap

.big-text-font[
- Intialize a plot with the `ggplot` function
- Specify our data source
- *Aesthetic* properties: choose which variables to use for x and y position
- *Geometric* object (geom): Specify the type of plot 
- We used the *point geom* `geom_point()` which produces a scatterplot
]

---

# Extending the plot

.big-text-font[
- Suppose we wanted to see how the relationship between the percent of people below poverty line and the percent of people college educated depends on if someone lives in a metropolitian area
- We can display this visually by assigning another aesthetic element to your desired variable
- Let's use the color aesthetic and map it to the `inmetro` variable
- List of common aesthetics: color, shape, size, line type, line size, transparency
]

---

# Midwest Demographics

.left-code[
```{r midwest-scatterplot2, eval=FALSE}
midwest$inmetro <- 
  factor(midwest$inmetro,
         levels = c("0", "1"),
         labels = c("No", "Yes"))
ggplot(midwest) +
  aes(x = percadultpoverty, 
      y = percollege,
      color = inmetro) + #<< 
  geom_point() 
```
]

.right-plot[
```{r midwest-scatterplot2-out, ref.label="midwest-scatterplot2", echo=FALSE}
```
]

---

# Improving the plot

.big-text-font[
- Let's make some adjustment to the formatting of the plot
- List of changes:
    - Add descriptive plot title
    - Make axis labels more descriptives
    - Change legend title
    - Add spacing between axis and axis labels 
]

---

# Midwest Demographics

.left-code[
```{r midwest-scatterplot3, eval=FALSE}
ggplot(midwest) +
  aes(x = percadultpoverty, 
      y = percollege,
      color = inmetro) +
  geom_point() +
  labs(title = "% College Educated by % Adults below poverty line", #<<
       subtitle = "2000 US Midwest Census", #<<
       color = "In Metro Area", #<<
       x = "% Adults below poverty line", #<<
       y = "% College Educated") + #<< 
    theme( #<<
      axis.title.x = #<<
        element_text( #<<
          margin = margin(t = 20, r = 0, #<<
                          b = 0, l = 0)), #<<
      axis.title.y = #<<
        element_text( #<<
          margin = margin(t = 0, r = 20, #<<
                          b = 0, l = 0)) #<<
    )
```
]

.right-plot[
```{r midwest-scatterplot3-out, ref.label="midwest-scatterplot3", echo=FALSE}
```
]
